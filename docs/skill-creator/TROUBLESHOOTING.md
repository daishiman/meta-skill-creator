# トラブルシューティング

Skill Creatorで発生する可能性のある問題と解決方法をまとめています。

---

## 目次

- [インストールの問題](#インストールの問題)
- [問題発見フェーズの問題](#問題発見フェーズの問題)
- [ドメインモデリングの問題](#ドメインモデリングの問題)
- [インタビューの問題](#インタビューの問題)
- [スキル生成の問題](#スキル生成の問題)
- [実行時の問題](#実行時の問題)
- [マルチスキル設計の問題](#マルチスキル設計の問題)
- [クロススキル依存解決の問題](#クロススキル依存解決の問題)
- [外部CLIエージェントの問題](#外部cliエージェントの問題)
- [interviewDepthの問題](#interviewdepthの問題)
- [Codex連携の問題](#codex連携の問題)
- [バリデーションエラー](#バリデーションエラー)
- [よくある質問](#よくある質問)

---

## インストールの問題

### プラグインが認識されない

**症状**: 「スキル作成」と言っても反応がない

**解決方法**:

1. プラグインの確認
   ```bash
   /plugin list
   ```
   `daishiman-skill-creator`が表示されることを確認

2. 再インストール
   ```bash
   /plugin uninstall daishiman-skill-creator
   /plugin install daishiman-skill-creator
   ```

3. Claude Codeを再起動

### Node.jsバージョンエラー

**症状**: スクリプト実行時に構文エラー

**解決方法**:

```bash
# バージョン確認
node --version

# v18以上にアップデート
nvm install 18
nvm use 18
```

---

## 問題発見フェーズの問題

### 問題発見がスキップされる

**症状**: Phase 0-0が実行されず、直接インタビューが始まる

**解決方法**:

1. 明示的にProblem Firstを指定
   ```
   「まず問題を特定してからスキルを作成したい」
   ```

2. Collaborativeモードを明示
   ```
   「Collaborativeモードでスキルを作成したい」
   ```

### 5 Whysが浅い

**症状**: 根本原因に到達する前に分析が終わる

**解決方法**:

1. もっと深く分析するよう依頼
   ```
   「もう少し深掘りしてください。まだ根本原因に到達していません」
   ```

2. 自分で根本原因を示す
   ```
   「根本原因は〇〇だと思います」
   ```

### problem-definition.jsonが生成されない

**症状**: 問題発見後に構造化データが出力されない

**解決方法**:

1. 出力を明示的に依頼
   ```
   「問題定義をJSONに構造化してください」
   ```

2. スキーマを確認
   ```bash
   cat skills/skill-creator/schemas/problem-definition.json
   ```

---

## ドメインモデリングの問題

### ドメイン分類が不適切

**症状**: Core/Supporting/Genericの分類が期待と異なる

**解決方法**:

1. 分類を修正するよう依頼
   ```
   「〇〇はCoreではなくSupportingです。修正してください」
   ```

2. ドメインの重要度を説明する
   ```
   「このスキルの存在理由は〇〇なので、それがCoreです」
   ```

### ユビキタス言語が不明確

**症状**: 用語の定義が曖昧、または専門用語が統一されていない

**解決方法**:

1. 用語を明示的に定義
   ```
   「"通知"はSlackメッセージ送信のみを指します」
   ```

2. 用語表の見直しを依頼
   ```
   「ユビキタス言語の一覧を見せてください」
   ```

### Bounded Contextが広すぎる

**症状**: スキルの責務範囲が広く、焦点がぼやけている

**解決方法**:

1. Non-Goalsを明示
   ```
   「このスキルは〇〇には対応しません」
   ```

2. スキルの分割を検討
   ```
   「このスキルは大きすぎます。分割を提案してください」
   ```

### domain-model.jsonが生成されない

**症状**: ドメインモデリング後に構造化データが出力されない

**解決方法**:

1. 出力を明示的に依頼
   ```
   「ドメインモデルをJSONに構造化してください」
   ```

2. スキーマを確認
   ```bash
   cat skills/skill-creator/schemas/domain-model.json
   ```

---

## インタビューの問題

### インタビューが始まらない

**症状**: スキル作成を依頼してもインタビューが開始されない

**解決方法**:

1. 明示的にモードを指定
   ```
   「Collaborativeモードでスキルを作成したい」
   ```

2. より具体的な依頼をする
   ```
   「新しいスキルを作成したい。インタビューを開始してください」
   ```

3. プラグインの再インストール

### インタビューが途中で止まる

**症状**: 質問の途中で進行が止まる

**解決方法**:

1. 「続けてください」と伝える
2. 前の回答をもう一度伝える
3. セッションを新しく開始する

### 選択肢以外の回答をしたい

**症状**: 提示された選択肢に該当するものがない

**解決方法**:

- 「その他」を選択して自由記述
- 選択肢を選んだ後に補足説明を追加

```
「5（その他）を選択します。具体的には〇〇がしたいです」
```

---

## スキル生成の問題

### スキル生成が失敗する

**症状**: 生成フェーズで停止する

**解決方法**:

1. エラーメッセージを確認
2. より具体的な要件を指定して再試行
3. シンプルな構成から始める
   ```
   「シンプル構成（SKILL.mdのみ）で作成して」
   ```

### 生成されたスキルが期待と違う

**症状**: 生成されたスキルが要件と異なる

**解決方法**:

1. インタビューで要件を明確に伝える
2. 生成後に修正を依頼
   ```
   「〇〇の部分を修正して」
   ```
3. プロンプト改善機能を使用
   ```
   「このスキルのプロンプトを改善して」
   ```

### Clean Architectureの層構造が不適切

**症状**: 生成されたスキルの層構造が期待と異なる

**解決方法**:

1. 層の配置を指定
   ```
   「〇〇はreferences/ではなくscripts/に配置してください」
   ```

2. 依存方向を確認
   ```
   「依存関係ルールに違反していないか確認してください」
   ```

### 依存関係エラー

**症状**: 生成されたスクリプトが依存関係エラーで動かない

**解決方法**:

```bash
# 依存関係をインストール
cd skills/your-skill-name
npm install
# または
pnpm install
```

---

## 実行時の問題

### スクリプト実行エラー

**症状**: `Error: Cannot find module`

**解決方法**:

1. プラグインディレクトリの確認
   ```bash
   /plugin info daishiman-skill-creator
   ```

2. 依存関係の確認とインストール

### メモリ不足エラー

**症状**: JavaScript heap out of memory

**解決方法**:

```bash
# メモリ制限を増やす
NODE_OPTIONS="--max-old-space-size=4096" node scripts/validate_all.js
```

### パーミッションエラー

**症状**: EACCES: permission denied

**解決方法**:

```bash
# ファイルの権限を確認
ls -la skills/your-skill-name/scripts/

# 実行権限を付与
chmod +x skills/your-skill-name/scripts/*.js
```

---

## マルチスキル設計の問題

### マルチスキル設計が発動しない

**症状**: 複数スキルが必要な依頼でも単一スキルとして設計される

**解決方法**:

1. 明示的にマルチスキルを指定
   ```
   「3つのスキルに分割して設計してください」
   ```

2. インタビューで複数の責務があることを強調
   ```
   「このスキルは通知とデータ変換と監視の3つの責務があります」
   ```

### 依存関係グラフのエラー

**症状**: `multi-skill-graph.json`の依存関係が循環している

**解決方法**:

1. 循環依存を解消するよう依頼
   ```
   「スキルA→Bの依存を解消してください」
   ```

2. 共通部分を別スキルに分離
   ```
   「共通ユーティリティを別スキルに切り出してください」
   ```

---

## クロススキル依存解決の問題

### 依存スキルが見つからない

**症状**: `skill-dependency-graph.json`の生成時に参照先スキルが見つからない

**解決方法**:

1. 依存先スキルのパスを確認
   ```
   「依存先のスキルは skills/other-skill にあります」
   ```

2. 依存先スキルのSKILL.mdが存在することを確認
   ```bash
   ls skills/other-skill/SKILL.md
   ```

### 公開インターフェースが不明

**症状**: 依存先スキルのどの機能を使うか特定できない

**解決方法**:

1. 使用する機能を明示
   ```
   「other-skillのscripts/utils.jsのformatDate関数を使います」
   ```

---

## 外部CLIエージェントの問題

### 外部CLIが見つからない

**症状**: `Error: CLI not found`

**解決方法**:

1. CLIがインストールされていることを確認
   ```bash
   which gemini
   gemini --version
   ```

2. PATHの確認
   ```bash
   echo $PATH
   ```

### 外部CLI実行が失敗

**症状**: 外部CLIエージェントの実行がエラーで終了

**解決方法**:

1. Claude Code単独で実行
   ```
   「外部CLIを使わずにClaude Codeのみで実行してください」
   ```

2. エラーメッセージを確認して再実行

---

## interviewDepthの問題

### quickモードで情報不足

**症状**: quickモードで自動推定された項目が実際の要件と異なる

**解決方法**:

1. standardまたはdetailedモードで再実行
   ```
   「detailedモードでインタビューをやり直してください」
   ```

2. 不足している情報を手動で補足
   ```
   「外部連携はGitHub APIとSlack APIが必要です」
   ```

---

## Codex連携の問題

### Codexに接続できない

**症状**: `Error: Codex CLI not found`

**解決方法**:

1. Codex CLIの確認
   ```bash
   which codex
   codex --version
   ```

2. PATHの確認
   ```bash
   echo $PATH
   ```

3. Codex CLIをインストール

### Codexタスクがタイムアウト

**症状**: Codex実行が時間切れ

**解決方法**:

1. タスクを小さく分割
2. ネットワーク接続を確認
3. Claude Code単独モードで実行
   ```
   「Claude Codeのみで実行して」
   ```

---

## バリデーションエラー

### 構造検証エラー

**症状**: `Structure validation failed`

**解決方法**:

1. 必須ファイルの確認（SKILL.mdが必須）
   ```bash
   ls skills/your-skill-name/SKILL.md
   ```

2. ディレクトリ構造の確認
   ```bash
   tree skills/your-skill-name/
   ```

### リンク検証エラー

**症状**: `Broken link detected`

**解決方法**:

1. 壊れたリンクの特定
   ```bash
   node skills/skill-creator/scripts/validate_links.js skills/your-skill-name
   ```

2. リンク先の修正または削除

### スキーマ検証エラー

**症状**: `Schema validation failed`

**解決方法**:

1. JSONファイルの構文確認
   ```bash
   node -e "require('./skills/your-skill-name/schemas/input.json')"
   ```

2. スキーマに準拠した形式に修正

---

## よくある質問

### Q: インストール場所はどこですか？

A: プラグインは `~/.claude/plugins/` にインストールされます。

### Q: 作成したスキルはどこに保存されますか？

A: カレントプロジェクトの `skills/` ディレクトリに生成されます。

### Q: 他の人と共有するには？

A: 作成したスキルを含むディレクトリをGitHubにプッシュし、プラグインとして配布できます。

### Q: 問題発見フェーズをスキップできますか？

A: 要件が明確な場合は、createモードを使用することで問題発見とドメインモデリングをスキップできます：

```
「createモードで〇〇スキルを作成して」
```

ただし、Collaborativeモード（推奨）では問題発見から始めることで、より的確なスキルが生成されます。

### Q: インタビューをスキップできますか？

A: 要件が明確な場合は、最初に詳細を伝えることでインタビューを短縮できます：

```
「GitHubのPRをSlackに通知するスキルを作成して。
- 問題: レビュー漏れが頻発している
- 機能: PR作成時に通知
- 外部連携: GitHub API, Slack API
- 認証: 環境変数
- スケジュール: イベント駆動（webhook）
- 構成: 標準」
```

### Q: 一度作成したスキルを更新するには？

A: 以下の方法で更新できます：

```
「skills/my-skill を更新して。〇〇の機能を追加したい」
```

### Q: バリデーションを手動で実行するには？

A: 以下のコマンドで実行できます：

```bash
# クイックバリデーション
node skills/skill-creator/scripts/quick_validate.js skills/your-skill-name

# 包括的バリデーション
node skills/skill-creator/scripts/validate_all.js skills/your-skill-name
```

### Q: 生成されたスキルのログを確認するには？

A: `LOGS.md`ファイルに実行ログが記録されます：

```bash
cat skills/your-skill-name/LOGS.md
```

### Q: ドメインモデルの出力を確認するには？

A: 生成された `domain-model.json` を確認します。ドメイン分類（Core/Supporting/Generic）、ユビキタス言語、Bounded Contextが含まれています。

### Q: 統合パターンはどこで確認できますか？

A: `references/integration-patterns.md` が索引となっており、REST API / GraphQL / Webhook / IPC の各パターンガイドへのリンクがあります。

### Q: インタビューの質問数を減らすには？

A: interviewDepthをquickに設定すると、3-4問の最小限の質問で残りは自動推定されます：

```
「quickモードでインタビューしてください」
```

### Q: 複数のスキルを一度に作成できますか？

A: はい。インタビューで複数の責務が検出された場合、マルチスキル設計（Phase 0.9）が自動的に発動します。明示的に指定することもできます：

```
「3つのスキルに分割して設計してください」
```

### Q: Gemini CLIを実行エンジンとして使うには？

A: Orchestrateモードで`gemini`を選択するか、外部CLIエージェント委譲（Phase 4.5）で自動的に使用されます：

```
「Gemini CLIで実行して」
```

### Q: クロススキル参照パターンはどこで確認できますか？

A: `references/cross-skill-reference-patterns.md` で相対パス参照やインターフェース特定のパターンを確認できます。

---

## サポート

上記で解決しない場合は、以下の情報を添えて[Issues](https://github.com/daishiman/daishiman-skills/issues)で報告してください：

1. **エラーメッセージ**（全文）
2. **実行したコマンドまたは操作**
3. **環境情報**
   ```bash
   uname -a          # OS
   node --version    # Node.js
   claude --version  # Claude Code
   ```
4. **再現手順**
5. **期待した動作と実際の動作**
